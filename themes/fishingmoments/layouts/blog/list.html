{{ define "main" }}
<div style="display:none">DEBUG: {{ .RelPermalink }} | {{ .Kind }} | {{ .Section }} | Sections={{ len .Sections }}</div>
{{- $isBlogHome := or (eq .RelPermalink "/blog/") (eq .RelPermalink "/fr/blog/") -}}
{{- if $isBlogHome -}}
{{/* ========== KNOWLEDGE CENTER HUB ========== */}}
<section class="knowledge-library">
  <div class="container">
    {{/* Header */}}
    <div class="library-header">
      <h1 data-i18n="knowledgeCenterTitle">Fishing Knowledge Center</h1>
      <p class="library-desc" data-i18n="knowledgeCenterDesc">Expert guides backed by science â€” fish behavior, weather patterns, seasonal strategies, and species-specific techniques.</p>
    </div>

    {{/* Search Bar */}}
    <div class="search-container">
      <input type="text" id="article-search" class="search-input" data-i18n-placeholder="searchArticles" placeholder="Search articles...">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </div>

    {{/* Category Grid */}}
    <div class="library-section">
      <h2 class="library-section-title" data-i18n="exploreByTopic">Explore by Topic</h2>
      <div class="category-grid">
        {{ range .Sections.ByWeight }}
        <a href="{{ .RelPermalink }}" class="category-card" data-category-slug="{{ .File.ContentBaseName }}">
          <div class="category-card-icon">
            {{ partial "category-icon.html" . }}
          </div>
          <h3 data-i18n-category="title">{{ .Title }}</h3>
          <p data-i18n-category="description">{{ .Description }}</p>
          <div class="category-card-count">
            <span class="article-count">{{ len .Pages }}</span> <span data-i18n="articles">articles</span>
          </div>
        </a>
        {{ end }}
      </div>
    </div>

    {{/* Pillar Articles - Featured articles (one per category with pillar: true) */}}
    {{ $pillarArticles := where .Site.RegularPages "Params.pillar" true }}
    {{ if $pillarArticles }}
    <div class="library-section">
      <h2 class="library-section-title" data-i18n="pillarGuides">Pillar Guides</h2>
      <div class="pillar-articles">
        {{ range $pillarArticles }}
          {{ partial "blog-card.html" . }}
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{/* Latest Articles */}}
    <div class="library-section">
      <h2 class="library-section-title" data-i18n="latestArticles">Latest Articles</h2>
      <div class="blog-grid">
        {{ range first 6 .Site.RegularPages }}
          {{ partial "blog-card.html" . }}
        {{ end }}
      </div>
    </div>

    {{/* About - Editorial Content (moved to bottom) */}}
    <div class="library-about">
      <h2 class="library-section-title" data-i18n="aboutKnowledgeCenter">About the Knowledge Center</h2>
      <div class="library-about-content" data-i18n-html="knowledgeCenterIntro"></div>
    </div>
  </div>
</section>

{{- else -}}
{{/* ========== CATEGORY PAGE ========== */}}
<section class="blog-list">
  <div class="container">
    {{/* Breadcrumb */}}
    <div class="breadcrumb">
      <a href="/blog/" data-i18n="knowledgeCenterName">Fishing Knowledge Center</a>
      <span class="breadcrumb-sep">/</span>
      <span>{{ .Title }}</span>
    </div>

    {{/* Category Header */}}
    <div class="blog-list-header">
      <h1>{{ .Title }}</h1>
      {{ with .Description }}<p class="blog-list-desc">{{ . }}</p>{{ end }}
    </div>

    {{/* Category Content (if any) */}}
    {{ .Content }}

    {{/* Articles in this category */}}
    <div class="blog-grid">
      {{ range .Pages }}
        {{ partial "blog-card.html" . }}
      {{ end }}
    </div>
  </div>
</section>

{{- end -}}

{{ end }}
