{{ define "main" }}
{{ if .Page.Parent.IsHome }}
{{/* ======= KNOWLEDGE CENTER HUB (/blog/) ======= */}}
<section class="knowledge-library">
  <div class="container">
    <div class="library-header">
      <h1>{{ .Title }}</h1>
      {{ with .Description }}<p class="library-desc">{{ . }}</p>{{ end }}
    </div>

    {{/* Search Bar */}}
    <div class="search-container">
      <input type="text" id="article-search" class="search-input" placeholder="Search articles...">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </div>

    {{/* Category Grid */}}
    <h2 class="library-section-title">Explore by Topic</h2>
    <div class="category-grid">
      {{ range .Sections.ByWeight }}
      <a href="{{ .Permalink }}" class="category-card">
        <div class="category-card-icon">
          {{ partial "category-icon.html" . }}
        </div>
        <h3>{{ .Title }}</h3>
        <p>{{ .Description }}</p>
        {{ $count := len .Pages }}
        {{ if gt $count 0 }}
        <span class="category-card-count">{{ $count }} {{ if eq $count 1 }}article{{ else }}articles{{ end }}</span>
        {{ else }}
        <span class="category-card-count category-card-soon">Coming soon</span>
        {{ end }}
      </a>
      {{ end }}
    </div>

    {{/* Pillar Articles */}}
    {{ $pillars := where .RegularPagesRecursive ".Params.pillar" true }}
    {{ if $pillars }}
    <div class="library-section">
      <h2 class="library-section-title">Pillar Guides</h2>
      <div class="blog-grid">
        {{ range $pillars }}
        {{ partial "blog-card.html" . }}
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{/* Latest Articles */}}
    <div class="library-section">
      <h2 class="library-section-title">Latest Articles</h2>
      <div class="blog-grid">
        {{ range first 6 .RegularPagesRecursive.ByDate.Reverse }}
        {{ partial "blog-card.html" . }}
        {{ end }}
      </div>
    </div>

    {{/* About this Knowledge Center - moved to bottom */}}
    {{ with .Content }}
    <div class="library-about">
      <h2 class="library-section-title">About This Knowledge Center</h2>
      <div class="library-about-content">
        {{ . }}
      </div>
    </div>
    {{ end }}
  </div>
</section>

{{ else }}
{{/* ======= CATEGORY LANDING PAGE (/blog/category/) ======= */}}
<section class="blog-list">
  <div class="container">
    <div class="blog-list-header">
      <nav class="breadcrumb">
        <a href="/blog/">Fishing Knowledge Center</a>
        <span class="breadcrumb-sep">/</span>
        <span>{{ .Title }}</span>
      </nav>
      <h1>{{ .Title }}</h1>
      {{ with .Description }}<p class="blog-list-desc">{{ . }}</p>{{ end }}
    </div>
    {{ .Content }}
    <div class="blog-grid">
      {{ range .Pages.ByDate.Reverse }}
      {{ partial "blog-card.html" . }}
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
